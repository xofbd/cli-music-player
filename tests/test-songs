#!/usr/bin/env bats

@test "one search word" {
  result=$(build/list-songs --directory tests/music/ "glove" | sort)
  expected="$(< tests/expected/one_search_word)"

  [[ "$result" == "$expected" ]]
}

@test "two search words" {
  result=$(build/list-songs --directory tests/music/ "in glove" | sort)
  expected="$(< tests/expected/two_search_words)"

  [[ "$result" == "$expected" ]]
}

@test "three search words" {
  result=$(build/list-songs --directory tests/music/ "hand in glove" | sort)
  expected="$(< tests/expected/three_search_words)"

  [[ "$result" == "$expected" ]]
}

@test "two search terms" {
  result=$(build/list-songs --directory tests/music/ "hand in glove" "live" | sort)
  expected="$(< tests/expected/two_search_terms)"

  [[ "$result" == "$expected" ]]
}

@test "find song with hyphen" {
  result=$(build/list-songs --directory tests/music/ "Annie Dog" | sort)
  expected="tests/music/The Smashing Pumpkins/Adore/Annie-Dog.mp3"

  [[ "$result" == "$expected" ]]
}

@test "no results" {
  result=$(build/list-songs --directory tests/music/ "no results for this" | sort)
  expected="No songs found with pattern"

  [[ "$result" == "$expected" ]]
}

@test "limit number of results" {
  num_results_all=$(build/list-songs --directory tests/music/ "hand in glove" | wc -l)
  num_results_two=$(build/list-songs --directory tests/music/ --max-results 2 "hand in glove" | wc -l)
  echo "$num_results_two"
  [[ "$num_results_all" -gt 1 ]]
  [[ "$num_results_two" -eq 2 ]]
}

@test "limit to first result found" {
  num_results_all=$(build/list-songs --directory tests/music/ "hand in glove" | wc -l)
  num_results_one=$(build/list-songs --directory tests/music/ --first "hand in glove" | wc -l)
  echo "$num_results_one"
  [[ "$num_results_all" -gt 1 ]]
  [[ "$num_results_one" -eq 1 ]]
}

@test "ignore max result option when first is set" {
  num_results_all=$(build/list-songs --directory tests/music/ "hand in glove" | wc -l)
  num_results_one=$(build/list-songs --directory tests/music/ --max-results 3 --first "hand in glove" | wc -l)
  echo "$num_results_one"
  [[ "$num_results_all" -gt 1 ]]
  [[ "$num_results_one" -eq 1 ]]
}
